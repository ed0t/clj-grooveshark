(ns clj-grooveshark.album-test
  (:require [clojure.data.json :as json])
  (:require [clj-http.client :as client])
  (:use clojure.test
        clj-grooveshark.album))



(defn stringify [query]
  {:body (json/write-str query)}
  )



(deftest should-check-if-an-album-exists
  (let [response (stringify {:header {:hostname "RHL073"}, :result true})]
    (with-redefs [client/get (fn [url body json] response)]
      (is (true? (get-does-album-exists? "api-key" "secret-key" 8790822)))
    )
  )
)

(deftest should-search-for-an-album
  (let [response (stringify {:header {:hostname "RHL109"}, :result {:pager {:numPages 27, :hasPrevPage false, :hasNextPage false}, :albums [{:AlbumID 1536356, :AlbumName "Mr. Beast", :ArtistID 1261, :ArtistName "Mogwai", :CoverArtFilename "1536356.jpg", :IsVerified true} {:AlbumID 7032744, :AlbumName "beast", :ArtistID 1153, :ArtistName "Kelly Clarkson", :CoverArtFilename "", :IsVerified false} {:AlbumID 8747919, :AlbumName "Fast & Furious 6 - www.CdsParaBaixar.Org", :ArtistID 2684610, :ArtistName "Syberian Beast meets Mr.Moore - www.CdsParaBaixar.Org", :CoverArtFilename "", :IsVerified false} {:AlbumID 411575, :AlbumName "The Beast of Alice Cooper", :ArtistID 132, :ArtistName "Alice Cooper", :CoverArtFilename "411575.jpg", :IsVerified true} {:AlbumID 2893323, :AlbumName "Beast", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified true} {:AlbumID 5181096, :AlbumName "Deep in the Heart of the Beast in the Sun", :ArtistID 1613248, :ArtistName "Colorfinger - Everclear", :CoverArtFilename "5181096.jpg", :IsVerified false} {:AlbumID 4863595, :AlbumName "Death Row [By Mr. Lou]", :ArtistID 19277, :ArtistName "Accept", :CoverArtFilename "", :IsVerified false} {:AlbumID 1247776, :AlbumName "Dj Kay Slay & Papoose - Beast From The East (Plus Bonus)", :ArtistID 1736, :ArtistName "Papoose", :CoverArtFilename "", :IsVerified false} {:AlbumID 8747654, :AlbumName "Fast & Furious 6", :ArtistID 2625888, :ArtistName "Syberian Beast meets Mr.Moore", :CoverArtFilename "", :IsVerified false} {:AlbumID 4149404, :AlbumName "The Last Summer", :ArtistID 61245, :ArtistName "Mr. Projectile", :CoverArtFilename "", :IsVerified true} {:AlbumID 6178099, :AlbumName "Mr Music Hits No.07", :ArtistID 1892077, :ArtistName "Beast Of Burden", :CoverArtFilename "", :IsVerified false} {:AlbumID 1245336, :AlbumName "Absolute Value", :ArtistID 21408, :ArtistName "Akrobatik", :CoverArtFilename "1245336.jpg", :IsVerified true} {:AlbumID 7236177, :AlbumName "Beast From the East", :ArtistID 29265, :ArtistName "Dokken", :CoverArtFilename "", :IsVerified true} {:AlbumID 4580368, :AlbumName "Chronicles of the Beast Man", :ArtistID 194851, :ArtistName "Mr. Hyde", :CoverArtFilename "4580368.jpg", :IsVerified true} {:AlbumID 8830225, :AlbumName "Bass Patrol Vol. 1", :ArtistID 2709111, :ArtistName "Mr.Moore, Syberian Beast", :CoverArtFilename "", :IsVerified true} {:AlbumID 8565528, :AlbumName "Lol", :ArtistID 2625888, :ArtistName "Syberian Beast meets Mr.Moore", :CoverArtFilename "", :IsVerified false} {:AlbumID 7734850, :AlbumName "Mr Beast (promo)", :ArtistID 1261, :ArtistName "Mogwai", :CoverArtFilename "", :IsVerified false} {:AlbumID 7485817, :AlbumName "No Time To Explain ", :ArtistID 2297169, :ArtistName "Mr.Fuby", :CoverArtFilename "", :IsVerified false} {:AlbumID 4877570, :AlbumName "Indie 69 Best of 2009", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified false} {:AlbumID 6203290, :AlbumName "Unknown Album (1/4/2009 12:28:40 PM)", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified false} {:AlbumID 3139486, :AlbumName "", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified false} {:AlbumID 7866494, :AlbumName "Mr. Beast EP", :ArtistID 1915622, :ArtistName "Akasha FX", :CoverArtFilename "7866494.jpg", :IsVerified false} {:AlbumID 8967751, :AlbumName "Headaches & Cigarettes", :ArtistID 2750915, :ArtistName "Phat Boi Phresh", :CoverArtFilename "", :IsVerified false} {:AlbumID 4821433, :AlbumName "Throw A Beat", :ArtistID 1523932, :ArtistName "Please Mr. Gravedigger", :CoverArtFilename "4821433.jpg", :IsVerified false} {:AlbumID 3632224, :AlbumName "Mr. Too Hood    Mr.too Good", :ArtistID 1234882, :ArtistName "R.I.O.t BOYZ", :CoverArtFilename "", :IsVerified false} {:AlbumID 7306578, :AlbumName "Beast Mode", :ArtistID 2237405, :ArtistName "Robby Techno", :CoverArtFilename "", :IsVerified false} {:AlbumID 4131135, :AlbumName "[CURVED 002 EP] No More Mr. Nice Guy", :ArtistID 1350895, :ArtistName "The Altered Beast", :CoverArtFilename "", :IsVerified false}]}})]
    (with-redefs [client/get (fn [url body json] response)]
      (is (= [{:AlbumID 1536356, :AlbumName "Mr. Beast", :ArtistID 1261, :ArtistName "Mogwai", :CoverArtFilename "1536356.jpg", :IsVerified true} {:AlbumID 7032744, :AlbumName "beast", :ArtistID 1153, :ArtistName "Kelly Clarkson", :CoverArtFilename "", :IsVerified false} {:AlbumID 8747919, :AlbumName "Fast & Furious 6 - www.CdsParaBaixar.Org", :ArtistID 2684610, :ArtistName "Syberian Beast meets Mr.Moore - www.CdsParaBaixar.Org", :CoverArtFilename "", :IsVerified false} {:AlbumID 411575, :AlbumName "The Beast of Alice Cooper", :ArtistID 132, :ArtistName "Alice Cooper", :CoverArtFilename "411575.jpg", :IsVerified true} {:AlbumID 2893323, :AlbumName "Beast", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified true} {:AlbumID 5181096, :AlbumName "Deep in the Heart of the Beast in the Sun", :ArtistID 1613248, :ArtistName "Colorfinger - Everclear", :CoverArtFilename "5181096.jpg", :IsVerified false} {:AlbumID 4863595, :AlbumName "Death Row [By Mr. Lou]", :ArtistID 19277, :ArtistName "Accept", :CoverArtFilename "", :IsVerified false} {:AlbumID 1247776, :AlbumName "Dj Kay Slay & Papoose - Beast From The East (Plus Bonus)", :ArtistID 1736, :ArtistName "Papoose", :CoverArtFilename "", :IsVerified false} {:AlbumID 8747654, :AlbumName "Fast & Furious 6", :ArtistID 2625888, :ArtistName "Syberian Beast meets Mr.Moore", :CoverArtFilename "", :IsVerified false} {:AlbumID 4149404, :AlbumName "The Last Summer", :ArtistID 61245, :ArtistName "Mr. Projectile", :CoverArtFilename "", :IsVerified true} {:AlbumID 6178099, :AlbumName "Mr Music Hits No.07", :ArtistID 1892077, :ArtistName "Beast Of Burden", :CoverArtFilename "", :IsVerified false} {:AlbumID 1245336, :AlbumName "Absolute Value", :ArtistID 21408, :ArtistName "Akrobatik", :CoverArtFilename "1245336.jpg", :IsVerified true} {:AlbumID 7236177, :AlbumName "Beast From the East", :ArtistID 29265, :ArtistName "Dokken", :CoverArtFilename "", :IsVerified true} {:AlbumID 4580368, :AlbumName "Chronicles of the Beast Man", :ArtistID 194851, :ArtistName "Mr. Hyde", :CoverArtFilename "4580368.jpg", :IsVerified true} {:AlbumID 8830225, :AlbumName "Bass Patrol Vol. 1", :ArtistID 2709111, :ArtistName "Mr.Moore, Syberian Beast", :CoverArtFilename "", :IsVerified true} {:AlbumID 8565528, :AlbumName "Lol", :ArtistID 2625888, :ArtistName "Syberian Beast meets Mr.Moore", :CoverArtFilename "", :IsVerified false} {:AlbumID 7734850, :AlbumName "Mr Beast (promo)", :ArtistID 1261, :ArtistName "Mogwai", :CoverArtFilename "", :IsVerified false} {:AlbumID 7485817, :AlbumName "No Time To Explain ", :ArtistID 2297169, :ArtistName "Mr.Fuby", :CoverArtFilename "", :IsVerified false} {:AlbumID 4877570, :AlbumName "Indie 69 Best of 2009", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified false} {:AlbumID 6203290, :AlbumName "Unknown Album (1/4/2009 12:28:40 PM)", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified false} {:AlbumID 3139486, :AlbumName "", :ArtistID 1033348, :ArtistName "Beast", :CoverArtFilename "", :IsVerified false} {:AlbumID 7866494, :AlbumName "Mr. Beast EP", :ArtistID 1915622, :ArtistName "Akasha FX", :CoverArtFilename "7866494.jpg", :IsVerified false} {:AlbumID 8967751, :AlbumName "Headaches & Cigarettes", :ArtistID 2750915, :ArtistName "Phat Boi Phresh", :CoverArtFilename "", :IsVerified false} {:AlbumID 4821433, :AlbumName "Throw A Beat", :ArtistID 1523932, :ArtistName "Please Mr. Gravedigger", :CoverArtFilename "4821433.jpg", :IsVerified false} {:AlbumID 3632224, :AlbumName "Mr. Too Hood    Mr.too Good", :ArtistID 1234882, :ArtistName "R.I.O.t BOYZ", :CoverArtFilename "", :IsVerified false} {:AlbumID 7306578, :AlbumName "Beast Mode", :ArtistID 2237405, :ArtistName "Robby Techno", :CoverArtFilename "", :IsVerified false} {:AlbumID 4131135, :AlbumName "[CURVED 002 EP] No More Mr. Nice Guy", :ArtistID 1350895, :ArtistName "The Altered Beast", :CoverArtFilename "", :IsVerified false}] (get-album-search-results "api-key" "secret-key" "Mr Beast")))
    )
  )
 )







